{{- if .Release.IsUpgrade }}

{{- $imageToChart := list (dict "771" "0.2.82") (dict "776" "0.2.93") (dict "781" "0.3.0") (dict "784" "0.4.0") }}

{{- $currentImage := include "harness.harness-manager-image" . | toString }}

{{- if eq $currentImage "0" }}
Warning: Starting 0.4.0, monthly releases should be done in order. Please don't skip any release for backward compatibility.
{{- else }}
    {{- $currentChartIndex := -1 }}
    {{- $currentChart := "" }}
    {{- $updateChartIndex := len $imageToChart }}
    {{- range $index, $chart := $imageToChart }}
        {{- if hasKey . $currentImage }}
            {{- $currentChartIndex := $index }}
            {{- $currentChart := $chart }}
        {{- end }}
    {{- end }}
    {{- if eq $currentChartIndex -1 }}
Warning: Your setup seems to have development images. Starting 0.4.0, monthly releases should be done in order. Please don't skip any release for backward compatibility.
    {{- else }}
        {{- $releaseGap := sub $updateChartIndex $currentChartIndex }}
        {{- if gt $releaseGap 1 }}
Warning: Your current chart is {{ $currentChart }}. Starting 0.4.0, monthly releases should be done in order. Please don't skip any release for backward compatibility.
        {{- end }}
    {{- end }}
{{- end }}

{{- if lt $currentImage "776" }}
# Chart 0.2.87

- Prior to version 0.2.87, All module level overrides must be present under `harness` key in override file
Eg.
To enable global receivers for "srm", use the following overrides

harness:
    srm:
        enable-receivers: true

- Starting version 0.2.87, All module level overrides must be present at root level in override file and NOT under `harness` key
Eg.
To enable global receivers for "srm", use the following overrides

srm:
    enable-receivers: true

- To change the existing override file, delete the root level "harness" key and de-indent the value (all module level overrides)
{{- end}}

{{- end }}